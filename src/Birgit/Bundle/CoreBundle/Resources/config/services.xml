<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>

        <!-- Task - Manager -->
        <parameter key="birgit.task_manager.class">Birgit\Domain\Task\TaskManager</parameter>

        <!-- Task - Queue Handlers -->
        <parameter key="birgit.task_queue_handler.cron.class">Birgit\Domain\Task\Queue\Handler\CronTaskQueueHandler</parameter>

        <!-- Project - Manager -->
        <parameter key="birgit.project_manager.class">Birgit\Domain\Project\ProjectManager</parameter>
        <!-- Project - Event Listener -->
        <parameter key="birgit.project_event_listener.class">Birgit\Domain\Project\ProjectEventListener</parameter>
        <!-- Project - Handlers -->
        <parameter key="birgit.project_handler.git.class">Birgit\Domain\Project\Handler\GitProjectHandler</parameter>
        <!-- Project - Task Handlers -->
        <parameter key="birgit.task_handler.project_check.class">Birgit\Domain\Project\Task\Handler\ProjectCheckTaskHandler</parameter>
        <!-- Project - Task Queue Handlers -->
        <parameter key="birgit.task_queue_handler.project_reference_create.class">Birgit\Domain\Project\Task\Queue\Handler\ProjectReferenceCreateTaskQueueHandler</parameter>
        <parameter key="birgit.task_queue_handler.project_reference_delete.class">Birgit\Domain\Project\Task\Queue\Handler\ProjectReferenceDeleteTaskQueueHandler</parameter>

        <!-- Project - Environment Handlers -->
        <parameter key="birgit.project_environment_handler.local.class">Birgit\Domain\Project\Environment\Handler\LocalProjectEnvironmentHandler</parameter>

    </parameters>

    <services>

        <!-- Task - Manager -->
        <service id="birgit.task_manager" class="%birgit.task_manager.class%">
            <argument type="service" id="doctrine" />
        </service>

        <!-- Task - Queue Handlers -->
        <service id="birgit.task_queue_handler.cron" class="%birgit.task_queue_handler.cron.class%">
            <argument type="service" id="birgit.task_manager" />
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="logger" />
            <tag name="birgit.task_queue_handler" />
        </service>

        <!-- Project - Manager -->
        <service id="birgit.project_manager" class="%birgit.project_manager.class%">
            <argument type="service" id="doctrine" />
        </service>
        <!-- Project - Event Listener -->
        <service id="birgit.project_event_listener" class="%birgit.project_event_listener.class%">
            <argument type="service" id="birgit.project_manager" />
            <tag name="kernel.event_subscriber" />
        </service>
        <!-- Project - Handlers -->
        <service id="birgit.project_handler.git" class="%birgit.project_handler.git.class%">
            <tag name="birgit.project_handler" />
        </service>
        <!-- Project - Task Handlers -->
        <service id="birgit.task_handler.project_check" class="%birgit.task_handler.project_check.class%">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="birgit.project_manager" />
            <argument type="service" id="birgit.task_manager" />
            <tag name="birgit.task_handler" />
        </service>

        <!-- Project - Task Queue Handlers -->
        <service id="birgit.task_queue_handler.project_reference_create" class="%birgit.task_queue_handler.project_reference_create.class%">
            <argument type="service" id="birgit.project_manager" />
            <argument type="service" id="birgit.task_manager" />
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="logger" />
            <tag name="birgit.task_queue_handler" />
        </service>
        <service id="birgit.task_queue_handler.project_reference_delete" class="%birgit.task_queue_handler.project_reference_delete.class%">
            <argument type="service" id="birgit.project_manager" />
            <argument type="service" id="birgit.task_manager" />
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="logger" />
            <tag name="birgit.task_queue_handler" />
        </service>

        <!-- Project - Environment Handlers -->
        <service id="birgit.project_environment_handler.local" class="%birgit.project_environment_handler.local.class%">
            <argument>%kernel.root_dir%</argument>
            <tag name="birgit.project_environment_handler" />
        </service>

    </services>

</container>
